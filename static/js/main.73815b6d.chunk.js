(this.webpackJsonpcompanion=this.webpackJsonpcompanion||[]).push([[0],{18:function(e,t,n){},52:function(e,t,n){},54:function(e,t,n){},64:function(e,t,n){},73:function(e,t,n){},74:function(e,t,n){},93:function(e,t,n){},94:function(e,t,n){"use strict";n.r(t);var a,s,r=n(0),o=n.n(r),c=n(21),i=n.n(c),l=(n(52),n(9)),d=n(16),u=n(8),j=(n(18),n(7)),p=n.n(j),m=n(12),b=(n(54),n(10)),h=n(11),f=n(28),x=n.n(f),O=n(1);function v(){return(v=Object(m.a)(p.a.mark((function e(t,n){var r,o,c,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("start recording"),e.next=3,fetch("".concat("https://companion-htv5.herokuapp.com/api/v1","/assemblyai"));case 3:return r=e.sent,e.next=6,r.json();case 6:return(o=e.sent).error&&alert(o.error),c=o.token,e.next=11,new WebSocket("wss://api.assemblyai.com/v2/realtime/ws?sample_rate=16000&token=".concat(c));case 11:a=e.sent,i={},a.onmessage=function(e){var a=t,s=JSON.parse(e.data);console.dir(s),i[s.audio_start]=s.text,console.dir(i);var r=Object.keys(i);r.sort((function(e,t){return e-t}));for(var o=0,c=r;o<c.length;o++){var l=c[o];i[l]&&(a+=" ".concat(i[l]))}n(a)},a.onerror=function(e){console.error(e),a.close()},a.onclose=function(e){console.log(e),a=null},a.onopen=function(){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){(s=new x.a(e,{type:"audio",mimeType:"audio/webm;codecs=pcm",recorderType:f.StereoAudioRecorder,timeSlice:250,desiredSampRate:16e3,numberOfAudioChannels:1,bufferSize:4096,audioBitsPerSecond:128e3,ondataavailable:function(e){var t=new FileReader;t.onload=function(){var e=t.result;a&&a.send(JSON.stringify({audio_data:e.split("base64,")[1]}))},t.readAsDataURL(e)}})).startRecording()})).catch((function(e){return console.error(e)}))};case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("stop recording"),a&&(a.send(JSON.stringify({terminate_session:!0})),a.close(),a=null),s&&(s.pauseRecording(),s=null);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){var t=Object(r.useState)(!1),n=Object(l.a)(t,2),a=n[0],s=n[1];return Object(O.jsx)(h.a,{size:"sm",className:"record-button",variant:"outline-danger",onClick:function(){a?function(){g.apply(this,arguments)}():function(e,t){v.apply(this,arguments)}(e.text,e.setText),s(!a)},children:a?"Stop":"Record"})}function w(e){var t,n;return Object(O.jsx)(b.a.Group,{className:"mb-2",controlId:null!==(t=e.controlId)&&void 0!==t?t:"formUsername",children:Object(O.jsx)(b.a.Control,{type:"email",placeholder:null!==(n=e.label)&&void 0!==n?n:"Email address"})})}function N(e){var t,n;return Object(O.jsx)(b.a.Group,{className:"mb-2",controlId:null!==(t=e.controlId)&&void 0!==t?t:"formPassword",children:Object(O.jsx)(b.a.Control,{type:"password",placeholder:null!==(n=e.label)&&void 0!==n?n:"Password"})})}function k(e){return Object(O.jsx)(b.a.Group,{className:"mb-2",controlId:e.controlId,children:Object(O.jsx)(b.a.Control,{type:"text",placeholder:e.label,value:e.value})})}function M(e){return Object(O.jsxs)(b.a.Group,{className:"mb-2 flex-row",controlId:e.controlId,children:[Object(O.jsx)(b.a.Control,{type:"text",placeholder:e.label,value:e.value,onChange:function(t){return e.setValue(t.target.value)},onKeyPress:e.onKeyPress}),Object(O.jsx)(y,{text:e.value,setText:e.setValue})]})}var S=function(e){var t=Object(u.f)(),n=Object(r.useState)(!1),a=Object(l.a)(n,2),s=a[0],o=a[1];function c(){return(c=Object(m.a)(p.a.mark((function n(a){var r,c,i,l,d,u,j,m;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a.preventDefault(),!s){n.next=3;break}return n.abrupt("return");case 3:return o(!0),r=a.target,c=r.elements.formFirstName.value,i=r.elements.formLastName.value,l=r.elements.formUsername.value,d=r.elements.formPassword.value,u={firstName:c,lastName:i,email:l,password:d,logs:[]},n.prev=10,n.next=13,fetch("".concat("https://companion-htv5.herokuapp.com/api/v1","/users"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(u)});case 13:return j=n.sent,n.next=16,j.json();case 16:m=n.sent,console.dir(m),m.error?window.alert("Couldn't create the account"):(e.setUser(m.user),t.push("/assess")),n.next=25;break;case 21:n.prev=21,n.t0=n.catch(10),console.log(n.t0),window.alert("Failed to contact server :(");case 25:o(!1);case 26:case"end":return n.stop()}}),n,null,[[10,21]])})))).apply(this,arguments)}return Object(O.jsxs)("div",{className:"reg-container align-center",children:[Object(O.jsx)("h1",{children:"Register"}),Object(O.jsxs)(b.a,{className:"reg width-30",onSubmit:function(e){return c.apply(this,arguments)},children:[Object(O.jsx)(k,{controlId:"formFirstName",label:"First name"}),Object(O.jsx)(k,{controlId:"formLastName",label:"Last name"}),Object(O.jsx)(w,{}),Object(O.jsx)(N,{}),Object(O.jsx)(N,{controlId:"formConfirmPassword",label:"Re-enter password"}),Object(O.jsx)(h.a,{className:"fullwidth",variant:"primary",disabled:s,type:"submit",children:s?"Registering\u2026":"Register"}),Object(O.jsx)("div",{className:"login-link-container",children:Object(O.jsx)(h.a,{className:"fullwidth",variant:"primary",onClick:function(){return t.push("/login")},children:"Log into existing account"})})]})]})};function C(e){var t=Object(u.f)(),n=Object(r.useState)(!1),a=Object(l.a)(n,2),s=a[0],o=a[1];function c(){return(c=Object(m.a)(p.a.mark((function n(a){var r,c,i,l,d,u;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a.preventDefault(),!s){n.next=3;break}return n.abrupt("return");case 3:return o(!0),r=a.target,c=r.elements.formUsername.value,i=r.elements.formPassword.value,l={email:c,password:i},console.dir(l),n.prev=9,console.log("".concat("https://companion-htv5.herokuapp.com/api/v1","/validate")),n.next=13,fetch("".concat("https://companion-htv5.herokuapp.com/api/v1","/validate"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)});case 13:return d=n.sent,n.next=16,d.json();case 16:u=n.sent,console.dir(u),u.data?(e.setUser(u.data),t.push("/assess")):window.alert("Invalid email or password, please try again"),n.next=25;break;case 21:n.prev=21,n.t0=n.catch(9),console.log(n.t0),window.alert("Failed to contact server :(");case 25:o(!1);case 26:case"end":return n.stop()}}),n,null,[[9,21]])})))).apply(this,arguments)}return Object(O.jsxs)("div",{className:"align-center",children:[Object(O.jsx)("h1",{children:"Log in"}),Object(O.jsxs)(b.a,{className:"width-30",onSubmit:function(e){return c.apply(this,arguments)},children:[Object(O.jsx)(w,{}),Object(O.jsx)(N,{}),Object(O.jsx)(h.a,{className:"fullwidth",variant:"primary",disabled:s,type:"submit",children:s?"Logging in\u2026":"Log in"})]})]})}n(64);var T=n(47);function I(){var e=Object(u.f)();return Object(O.jsx)(T.a,{steps:[{style:{transform:"translate(0,-500px)"},duration:0},{style:{transform:"translate(0,0)"},duration:800}],children:Object(O.jsxs)("div",{className:"align-center",children:[Object(O.jsx)("h1",{children:"Companion"}),Object(O.jsx)("h2",{children:"your mindfulness buddy"}),Object(O.jsx)(h.a,{className:"wide get-started",size:"lg",variant:"primary",onClick:function(){return e.push("/register")},children:"Get Started"})]})})}n(73);function P(e){var t=Object(u.f)(),n=Object(r.useState)(!1),a=Object(l.a)(n,2),s=a[0],o=a[1],c=Object(r.useState)(!1),i=Object(l.a)(c,2),d=i[0],j=i[1],f=Object(r.useState)(null),x=Object(l.a)(f,2),v=x[0],g=x[1],y=Object(r.useState)(""),w=Object(l.a)(y,2),N=w[0],k=w[1];function S(e){return C.apply(this,arguments)}function C(){return(C=Object(m.a)(p.a.mark((function t(n){var a,r,c;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),!s){t.next=3;break}return t.abrupt("return");case 3:return o(!0),a={mood:v,message:N},t.prev=5,t.next=8,fetch("".concat("https://companion-htv5.herokuapp.com/api/v1","/").concat(e.user._id,"/logs"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 8:return r=t.sent,t.next=11,r.json();case 11:c=t.sent,console.dir(c),c.error?(console.dir(c.error),window.alert("Couldn't save, please try again")):j(!0),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(5),console.dir(t.t0),window.alert("Failed to contact server :(");case 20:o(!1);case 21:case"end":return t.stop()}}),t,null,[[5,16]])})))).apply(this,arguments)}return Object(O.jsxs)("div",{className:"align-center flex-column gap-4",children:[Object(O.jsxs)("h1",{children:["Welcome back, ",e.user.firstName]}),Object(O.jsx)("h2",{children:"How are you feeling today?"}),Object(O.jsx)(A,{mood:v,setMood:g}),Object(O.jsxs)(b.a,{className:"width-50",onSubmit:S,children:[Object(O.jsx)(M,{controlId:"formMessage",label:"Describe your day\u2026",value:N,setValue:k}),Object(O.jsxs)("div",{className:"align-center flex-column",children:[Object(O.jsx)(h.a,{className:"fullwidth",variant:"success",onClick:S,disabled:!v||s||d,children:s?"Saving\u2026":d?"Entry saved":"Save"}),Object(O.jsxs)("div",{className:"fullwidth flex-row gap-2",children:[Object(O.jsx)(h.a,{className:"fullwidth",variant:"primary",onClick:function(){t.push("/diary")},children:"My diary"}),Object(O.jsx)(h.a,{className:"fullwidth",variant:"primary",onClick:function(){t.push("/companion")},children:"Talk to someone"})]})]})]})]})}function A(e){return Object(O.jsxs)("div",{className:"mood-chooser",children:[Object(O.jsx)(F,{currentMood:e.mood,setMood:e.setMood,mood:"\u263a\ufe0f"}),Object(O.jsx)(F,{currentMood:e.mood,setMood:e.setMood,mood:"\ud83d\ude04"}),Object(O.jsx)(F,{currentMood:e.mood,setMood:e.setMood,mood:"\ud83d\ude00"}),Object(O.jsx)(F,{currentMood:e.mood,setMood:e.setMood,mood:"\ud83d\ude42"}),Object(O.jsx)(F,{currentMood:e.mood,setMood:e.setMood,mood:"\ud83d\ude10"}),Object(O.jsx)("hr",{}),Object(O.jsx)(F,{currentMood:e.mood,setMood:e.setMood,mood:"\ud83d\ude15"}),Object(O.jsx)(F,{currentMood:e.mood,setMood:e.setMood,mood:"\u2639\ufe0f"}),Object(O.jsx)(F,{currentMood:e.mood,setMood:e.setMood,mood:"\ud83d\ude14"}),Object(O.jsx)(F,{currentMood:e.mood,setMood:e.setMood,mood:"\ud83d\ude25"}),Object(O.jsx)(F,{currentMood:e.mood,setMood:e.setMood,mood:"\ud83d\ude2d"})]})}function F(e){return Object(O.jsx)(h.a,{size:"sm",variant:"primary",className:"mood-button ",active:e.currentMood==e.mood,onClick:function(){return e.setMood(e.mood)},children:e.mood})}n(74),n(75);var R=function(e){var t=Object(r.useState)([]),n=Object(l.a)(t,2),a=n[0],s=n[1],o=Object(r.useState)(""),c=Object(l.a)(o,2),i=c[0],d=c[1],u=Object(r.useState)(""),j=Object(l.a)(u,2),b=(j[0],j[1]),f=function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://companion-api-htv5.herokuapp.com/api/v1/12345678",e.next=3,fetch("https://companion-api-htv5.herokuapp.com/api/v1/12345678",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({message:t})});case 3:return n=e.sent,e.next=6,n.json();case 6:return a=e.sent,b(a),e.abrupt("return",a.message);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.push({user:i}),s(a),t=i,d(""),e.next=6,f(t);case 6:""===(n=e.sent)&&(n="Can you rephrase that? I don't seem to understand"),a.push({bot:n}),s(a),b("");case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(){var t=Object(m.a)(p.a.mark((function t(){var n,s,r,o;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"https://companion-htv5.herokuapp.com/api/v1/",n=e.user._id,"/logs/conversations",s="https://companion-htv5.herokuapp.com/api/v1/"+n+"/logs/conversations",console.log(s),t.next=7,fetch(s,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({messages:a})});case 7:return r=t.sent,t.next=10,r.json();case 10:o=t.sent,console.log(o);case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(O.jsxs)("div",{children:[Object(O.jsx)("h1",{children:"Companion"}),Object(O.jsx)("div",{className:"messages-view-container",children:Object(O.jsx)("div",{className:"messages-view",children:Object(O.jsx)("div",{className:"message",children:a.map((function(e){return Object(O.jsx)("div",{children:e.user?Object(O.jsxs)("div",{className:"user-message",children:["You: ",e.user]}):Object(O.jsxs)("div",{className:"bot-message",children:["Bot: ",e.bot]})})}))})})}),Object(O.jsx)(M,{className:"message-input",controlId:"formMessage",label:"Type Message Here",value:i,setValue:d,onKeyPress:function(e){return"Enter"===e.key&&x()}}),Object(O.jsx)(h.a,{onClick:v,children:"Save Conversation"})]})};n(93);function J(e){var t=Object(u.f)(),n=Object(r.useState)(!1),a=Object(l.a)(n,2),s=(a[0],a[1]),o=Object(r.useState)(null),c=Object(l.a)(o,2),i=c[0],d=c[1];return Object(r.useEffect)(Object(m.a)(p.a.mark((function t(){var n,a;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s(!0),t.prev=1,t.next=4,fetch("".concat("https://companion-htv5.herokuapp.com/api/v1","/").concat(e.user._id,"/logs"),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});case 4:return n=t.sent,t.next=7,n.json();case 7:a=t.sent,console.dir(a),a.error?(console.dir(a.error),window.alert("Couldn't retrieve entries, please try again")):d(a.logs),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(1),console.dir(t.t0),window.alert("Failed to contact server :(");case 16:s(!1);case 17:case"end":return t.stop()}}),t,null,[[1,12]])}))),[e.user]),Object(O.jsxs)("div",{className:"width-60 flex-column gap-4",children:[Object(O.jsx)("h1",{children:"My diary"}),Object(O.jsx)("ul",{className:"fullwidth diary-container",children:i&&i.map((function(e,t){return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("li",{children:Object(O.jsx)(U,{log:e,index:t})},"log-entry-".concat(t)),t!==i.length-1&&Object(O.jsx)("hr",{})]})}))}),Object(O.jsx)("div",{className:"fullwidth flex-row gap-2",children:Object(O.jsx)(h.a,{className:"fullwidth",variant:"primary",onClick:function(){t.push("/assess")},children:"Go Back"})})]})}function U(e){return Object(O.jsxs)("div",{className:"flex-row",style:{justifyContent:"flex-start"},children:[Object(O.jsx)("p",{className:"align-left mood",children:e.log.mood}),Object(O.jsxs)("div",{className:"flex-column",style:{alignItems:"flex-start"},children:[Object(O.jsx)("p",{className:"align-left message",children:e.log.message}),Object(O.jsx)("ul",{children:e.log.conversations&&e.log.conversations.map((function(t,n){return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)("li",{children:Object(O.jsxs)("details",{children:[Object(O.jsxs)("summary",{className:"align-left conversation",children:["Conversation #",n+1]}),Object(O.jsx)("p",{className:"align-left conversation",children:t.map((function(e){var a;return Object(O.jsxs)(O.Fragment,{children:[e.user&&Object(O.jsx)("span",{className:"align-left",style:{display:"inline-block",minWidth:"150px"},children:"You:\u2003"}),e.bot&&Object(O.jsx)("span",{className:"align-left",style:{display:"inline-block",minWidth:"150px"},children:"Companion:\u2003"}),null!==(a=e.user)&&void 0!==a?a:e.bot,n!==t.length-1&&Object(O.jsx)("br",{})]})}))})]})},"log-entry-".concat(e.index,"-conversation-").concat(n))})}))})]})]})}var L=function(){var e=Object(r.useState)({_id:"616b918b2749f77e074616ac",email:"demo@demo.user",firstName:"Demo",lastName:"User",password:"password",logs:[]}),t=Object(l.a)(e,2),n=t[0],a=t[1];return Object(O.jsx)("div",{className:"App flex-column",children:Object(O.jsx)(d.a,{children:Object(O.jsxs)(u.c,{children:[Object(O.jsx)(u.a,{exact:!0,path:"/",children:Object(O.jsx)(I,{})}),Object(O.jsx)(u.a,{exact:!0,path:"/login",children:Object(O.jsx)(C,{setUser:a})}),Object(O.jsx)(u.a,{exact:!0,path:"/register",children:Object(O.jsx)(S,{setUser:a})}),Object(O.jsx)(u.a,{exact:!0,path:"/assess",children:Object(O.jsx)(P,{user:n})}),Object(O.jsx)(u.a,{exact:!0,path:"/companion",children:Object(O.jsx)(R,{user:n})}),Object(O.jsx)(u.a,{exact:!0,path:"/diary",children:Object(O.jsx)(J,{user:n})})]})})})};i.a.render(Object(O.jsx)(o.a.StrictMode,{children:Object(O.jsx)(L,{})}),document.getElementById("root"))}},[[94,1,2]]]);
//# sourceMappingURL=main.73815b6d.chunk.js.map